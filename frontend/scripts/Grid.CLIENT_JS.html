<!--<link type="text/css" rel="stylesheet" href="jsgrid.min.css" />-->
<!--<link type="text/css" rel="stylesheet" href="jsgrid-theme.min.css" />-->
<script type="text/javascript" src="//altitudebreath.github.io/jsgrid/js/jsgrid.js"></script>
<script>
    console.log('-- Grid.CLIENT_JS -------->');
    
    var DateField = function(config) {
        jsGrid.Field.call(this, config);
    };
 
    DateField.prototype = new jsGrid.Field({
        sorter: function(date1, date2) {
            return new Date(date1) - new Date(date2);
        },
 
        itemTemplate: function(value) {
            return new Date(value).toDateString();
        },
 
        insertTemplate: function(value) {
            return this._insertPicker = $("<input>").datepicker({ defaultDate: new Date() });
        },
 
        editTemplate: function(value) {
            return this._editPicker = $("<input>").datepicker().datepicker("setDate", new Date(value));
        },
 
        insertValue: function() {
            return this._insertPicker.datepicker("getDate").toISOString();
        },
 
        editValue: function() {
            return this._editPicker.datepicker("getDate").toISOString();
        }
    });
 
    function initGrid(params){
        params.common = params.common || {};
        
        jsGrid.fields.date = DateField;

        $("#data-grid").jsGrid({
                height: "1000px",
                width: "100%",
         
                filtering: true,
                editing: params.editing || false,
                inserting: params.inserting || false,
    
                sorting: true,
                //paging: true,
                //pageLoading: true,
            
                autoload: true,
                
                //pageSize: 15,
                //pageButtonCount: 5,
         
                fields: params.fields.concat([{type: 'control'}]),

                controller: {
                    loadData: function(aFilter) {
                        var options = {};
                        //returns a Promise
                        if (aFilter){
                            if (typeof aFilter.pageIndex !== "undefined"){
                                options.pageIndex = aFilter.pageIndex;
                                delete aFilter.pageIndex;
                                options.pageSize = aFilter.pageSize;
                                delete aFilter.pageSize;
                            }
                            options.criteria = aFilter;
                            return callAction(params.entity, 'select', 
                                    $.extend(options, params.common));
                        }else {
                            return callAction(params.entity, 'getMany', 
                                    $.extend(options, params.common));
                        }
                    },
                    insertItem: function(item) {
                        //returns a Promise
                        return callAction(params.entity, 'create', 
                                $.extend({item: item}, params.common)
                        );
                    },
                    updateItem: function(item) {
                        //returns a Promise
                        return callAction(params.entity, 'update', 
                                $.extend({item: item}, params.common)
                        );
                    },
                    
                },
         
            });
         
    };
</script>